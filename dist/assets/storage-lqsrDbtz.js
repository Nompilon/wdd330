(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))u(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const g of n.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&u(g)}).observe(document,{childList:!0,subtree:!0});function v(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function u(o){if(o.ep)return;o.ep=!0;const n=v(o);fetch(o.href,n)}})();document.addEventListener("DOMContentLoaded",()=>{const m=document.getElementById("open-meal-modal"),l=document.getElementById("meal-modal"),v=document.getElementById("close-meal-modal"),u=document.getElementById("meal-form"),o=document.getElementById("recent-meals"),n=document.querySelectorAll(".summary .nutrient");let g=null;m.addEventListener("click",()=>l.classList.remove("hidden")),v.addEventListener("click",()=>{l.classList.add("hidden"),u.reset(),g=null}),u.addEventListener("submit",E=>{E.preventDefault();const I=document.getElementById("meal-type").value,h=document.getElementById("food-name").value.trim(),t=parseFloat(document.getElementById("portion").value);if(!h||isNaN(t)||t<=0){alert("Enter valid meal info.");return}const y={mealType:I,foodName:h,portion:t,calories:t*2,protein:t*.1,carbs:t*.2,fat:t*.05};let p=JSON.parse(localStorage.getItem("meals"))||[];g!==null?(p[g]=y,g=null):p.push(y),localStorage.setItem("meals",JSON.stringify(p)),L(),u.reset(),l.classList.add("hidden")});function L(){const E=JSON.parse(localStorage.getItem("meals"))||[];o.innerHTML="";const I={calories:0,protein:0,carbs:0,fat:0};E.slice(-5).reverse().forEach((t,y)=>{I.calories+=Number(t.calories),I.protein+=Number(t.protein),I.carbs+=Number(t.carbs),I.fat+=Number(t.fat);const p=document.createElement("li");p.textContent=`${t.mealType}: ${t.foodName} (${t.portion}g) — ${t.calories} kcal`,o.appendChild(p)}),[{key:"calories",max:2e3,unit:"kcal"},{key:"protein",max:150,unit:"g"},{key:"carbs",max:250,unit:"g"},{key:"fat",max:70,unit:"g"}].forEach((t,y)=>{const p=I[t.key],S=Math.min(p/t.max*100,100),b=n[y];b.querySelector("p").innerHTML=`<strong>${t.key}:</strong> ${p.toFixed(1)} / ${t.max} ${t.unit}`,b.querySelector(".progress-fill").style.width=`${S}%`})}L()});document.addEventListener("DOMContentLoaded",()=>{const m=document.getElementById("open-meal-modal"),l=document.getElementById("meal-modal"),v=document.getElementById("close-meal-modal"),u=document.getElementById("meal-form"),o=document.getElementById("recent-meals"),n=document.getElementById("food-name"),g=document.getElementById("food-suggestions"),L=document.getElementById("goals-form"),E=document.getElementById("goal-calories"),I=document.getElementById("goal-protein"),h=document.getElementById("goal-carbs"),t=document.getElementById("goal-fat");let y=null,p=null;const S="l3MBTuUIJoqsUO9IvnLe8wKSDqT6dRQaTyLs7GTE";async function b(a){try{const r=await(await fetch(`https://api.nal.usda.gov/fdc/v1/foods/search?query=${encodeURIComponent(a)}&pageSize=1&api_key=${S}`)).json();if(!r.foods||r.foods.length===0)return null;const c=r.foods[0],s={calories:0,protein:0,carbs:0,fat:0};return c.foodNutrients&&c.foodNutrients.forEach(e=>{const d=e.nutrientName.toLowerCase(),f=e.value||0;d.includes("energy")&&(s.calories=f),d.includes("protein")&&(s.protein=f),d.includes("carbohydrate")&&(s.carbs=f),(d.includes("total lipid")||d.includes("fat"))&&(s.fat=f)}),s}catch(i){return console.error("USDA API error:",i),null}}function B(){return JSON.parse(localStorage.getItem("nutrientGoals"))||{calories:2e3,protein:150,carbs:250,fat:70}}function $(a){localStorage.setItem("nutrientGoals",JSON.stringify(a)),N()}function x(){const a=B();E.value=a.calories,I.value=a.protein,h.value=a.carbs,t.value=a.fat}L&&L.addEventListener("submit",a=>{a.preventDefault();const i={calories:parseInt(E.value)||2e3,protein:parseInt(I.value)||150,carbs:parseInt(h.value)||250,fat:parseInt(t.value)||70};$(i),alert("Nutrient goals updated!")});function M(){const a={calories:parseInt(prompt("Set daily calorie goal:",2e3))||2e3,protein:parseInt(prompt("Set daily protein goal (g):",150))||150,carbs:parseInt(prompt("Set daily carbs goal (g):",250))||250,fat:parseInt(prompt("Set daily fat goal (g):",70))||70};$(a),x()}m.addEventListener("click",()=>l.classList.remove("hidden")),v.addEventListener("click",()=>{l.classList.add("hidden"),u.reset(),y=null}),n.addEventListener("input",()=>{clearTimeout(p);const a=n.value.trim();a.length<2||(p=setTimeout(async()=>{try{const r=await(await fetch(`https://api.nal.usda.gov/fdc/v1/foods/search?query=${encodeURIComponent(a)}&pageSize=10&api_key=${S}`)).json();g.innerHTML="",r.foods&&r.foods.length>0&&r.foods.forEach(c=>{const s=document.createElement("option");s.value=c.description,g.appendChild(s)})}catch(i){console.error(i)}},300))}),u.addEventListener("submit",async a=>{a.preventDefault();const i=document.getElementById("meal-type").value,r=n.value.trim(),c=parseFloat(document.getElementById("portion").value);if(!r||isNaN(c)||c<=0)return alert("Enter valid food name and portion.");const s=await b(r);if(!s)return alert("Food not found in USDA database!");const e={mealType:i,foodName:r,portion:c,calories:((s.calories||0)*c/100).toFixed(0),protein:((s.protein||0)*c/100).toFixed(1),carbs:((s.carbs||0)*c/100).toFixed(1),fat:((s.fat||0)*c/100).toFixed(1)};let d=JSON.parse(localStorage.getItem("meals"))||[];y!==null?(d[y]=e,y=null):d.push(e),localStorage.setItem("meals",JSON.stringify(d)),u.reset(),l.classList.add("hidden"),N()});function N(){const a=JSON.parse(localStorage.getItem("meals"))||[];o.innerHTML="";let i={calories:0,protein:0,carbs:0,fat:0};a.forEach((e,d)=>{i.calories+=parseFloat(e.calories),i.protein+=parseFloat(e.protein),i.carbs+=parseFloat(e.carbs),i.fat+=parseFloat(e.fat);const f=document.createElement("li");f.innerHTML=`
                ${e.mealType}: ${e.foodName} (${e.portion}g) — ${e.calories} kcal,
                P:${e.protein}g C:${e.carbs}g F:${e.fat}g
                <span class="meal-actions">
                    <a href="#" class="edit-meal">Edit</a> |
                    <a href="#" class="delete-meal">Delete</a>
                </span>
            `,f.querySelector(".edit-meal").addEventListener("click",()=>{document.getElementById("meal-type").value=e.mealType,n.value=e.foodName,document.getElementById("portion").value=e.portion,l.classList.remove("hidden"),y=d}),f.querySelector(".delete-meal").addEventListener("click",()=>{a.splice(d,1),localStorage.setItem("meals",JSON.stringify(a)),N()}),o.appendChild(f)});const r=B(),c=[{key:"calories",max:r.calories,unit:"kcal"},{key:"protein",max:r.protein,unit:"g"},{key:"carbs",max:r.carbs,unit:"g"},{key:"fat",max:r.fat,unit:"g"}],s=document.querySelectorAll(".summary .nutrient");c.forEach((e,d)=>{const f=i[e.key].toFixed(1),k=Math.min(f/e.max*100,100).toFixed(0),D=s[d],O=D.querySelector("p");O.innerHTML=`<strong>${e.key.charAt(0).toUpperCase()+e.key.slice(1)}:</strong> ${f} / ${e.max} ${e.unit}`,D.querySelector(".progress-fill").style.width=`${k}%`})}localStorage.getItem("nutrientGoals")||M(),x(),N()});document.addEventListener("DOMContentLoaded",()=>{const m=document.querySelector(".menu-btn"),l=document.querySelector(".mobile-menu");m&&m.addEventListener("click",()=>{l.classList.toggle("active")})});const F=document.getElementById("profile-img"),T=document.getElementById("profile-upload");window.addEventListener("DOMContentLoaded",()=>{const m=localStorage.getItem("profileImage");m&&(F.src=m)});T.addEventListener("change",m=>{const l=m.target.files[0];if(!l)return;const v=new FileReader;v.onload=u=>{const o=u.target.result;F.src=o,localStorage.setItem("profileImage",o)},v.readAsDataURL(l)});
